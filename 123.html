<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niebieska Strona NBP + Mapa + Quiz</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body {
            /* TÅ‚o - Gradient + Kontury Topograficzne */
            background-color: #e3f2fd;
            background-image:
                url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0c15 5 25 15 30 30s5 30 20 40 30-5 40-20 20-25 30-30m-120 40c15 5 25 15 30 30s5 30 20 40 30-5 40-20 20-25 30-30' stroke='%2342a5f5' stroke-width='1.5' stroke-opacity='0.15' fill='none'/%3E%3Cpath d='M60 60c15 5 25 15 30 30s5 30 20 40 30-5 40-20 20-25 30-30' stroke='%231976d2' stroke-width='1.5' stroke-opacity='0.1' fill='none'/%3E%3C/svg%3E"),
                linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            background-attachment: fixed;

            color: #0d47a1;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        h1 {
            color: #0d47a1;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            background-color: rgba(255, 255, 255, 0.6);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .main-container {
            display: flex;
            flex-direction: row;
            gap: 30px;
            max-width: 1200px;
            width: 100%;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
        }

        #content {
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid #64b5f6;
            border-radius: 12px;
            padding: 25px;
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(4px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        #map-container {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            height: 450px;
            border: 2px solid #64b5f6;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            background-color: white;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* Sekcja Ciekawostek */
        #trivia-box {
            margin-top: 30px;
            width: 100%;
            max-width: 1130px;
            background-color: rgba(187, 222, 251, 0.95);
            border-left: 6px solid #1976d2;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
            animation: fadeIn 0.5s ease-in;
            backdrop-filter: blur(2px);
        }

        /* Sekcja Quizu */
        #quiz-box {
            margin-top: 20px;
            width: 100%;
            max-width: 1130px;
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid #1976d2;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
            animation: slideUp 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .quiz-title {
            font-size: 1.3em;
            color: #0d47a1;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 10px;
        }

        .question-card {
            background: #f1f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #64b5f6;
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 10px;
            color: #37474f;
        }

        .options label {
            display: block;
            margin: 5px 0;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .options label:hover {
            background-color: #e1f5fe;
        }

        /* Style odpowiedzi */
        .option-correct {
            background-color: #c8e6c9 !important;
            color: #2e7d32;
            font-weight: bold;
            border: 1px solid #81c784;
        }

        .option-wrong {
            background-color: #ffcdd2 !important;
            color: #c62828;
            border: 1px solid #e57373;
        }

        .result-box {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.2em;
        }

        .correct {
            color: #1b5e20;
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
        }

        .wrong {
            color: #b71c1c;
            background-color: #ffebee;
            border: 1px solid #ffcdd2;
        }

        .btn-check {
            background-color: #00897b;
            margin-top: 10px;
            font-size: 0.9em;
            padding: 10px 20px;
        }

        .btn-check:hover {
            background-color: #00796b;
        }

        .trivia-title {
            font-weight: bold;
            font-size: 1.2em;
            color: #0d47a1;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .trivia-text {
            color: #1e3a5f;
            line-height: 1.6;
            font-size: 1.05em;
        }

        button {
            margin-top: 30px;
            background-color: #1976d2;
            background-image: linear-gradient(45deg, #1976d2, #1565c0);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(25, 118, 210, 0.4);
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.6);
        }

        button:active {
            transform: scale(0.95);
        }

        .currency-code {
            font-size: 2.5em;
            font-weight: 800;
            color: #0277bd;
            margin-bottom: 5px;
        }

        .currency-name {
            font-size: 1.2em;
            color: #546e7a;
            margin-bottom: 15px;
            text-transform: capitalize;
            text-align: center;
        }

        .currency-rate {
            font-size: 1.8em;
            color: #0d47a1;
            font-weight: bold;
            background-color: #e1f5fe;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .country-section {
            width: 100%;
            border-top: 1px dashed #b0bec5;
            padding-top: 20px;
            margin-top: 10px;
            text-align: center;
        }

        .country-title {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #78909c;
            margin-bottom: 15px;
        }

        .country-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .flag-img {
            width: 100px;
            height: auto;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .country-names {
            font-weight: 600;
            color: #37474f;
            font-size: 1.1em;
        }

        .meta {
            margin-top: auto;
            padding-top: 20px;
            font-size: 0.8em;
            color: #90a4ae;
            width: 100%;
            text-align: center;
        }

        .loading {
            color: #0288d1;
            font-style: italic;
        }

        .map-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #78909c;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <h1>NBP + Kraje + Quiz</h1>

    <div class="main-container">
        <!-- Lewa strona: Dane -->
        <div id="content">
            <p style="text-align: center; color: #78909c;">
                Kliknij przycisk poniÅ¼ej, aby wylosowaÄ‡ walutÄ™,<br>
                zobaczyÄ‡ jej kurs oraz wziÄ…Ä‡ udziaÅ‚ w quizie.
            </p>
        </div>

        <!-- Prawa strona: Mapa -->
        <div id="map-container">
            <div id="map"></div>
            <div id="map-overlay" class="map-placeholder">Czekam na dane...</div>
        </div>
    </div>

    <!-- Sekcja Ciekawostki -->
    <div id="trivia-box">
        <div class="trivia-title">ðŸ’¡ Czy wiesz, Å¼e?</div>
        <div id="trivia-content" class="trivia-text"></div>
    </div>

    <!-- Sekcja Quizu -->
    <div id="quiz-box">
        <div class="quiz-title">ðŸ§  Mini Quiz o Wylosowanym Kraju</div>
        <div id="quiz-questions"></div>
        <button onclick="checkQuiz()" class="btn-check" id="btn-quiz-check" style="display:none">SprawdÅº
            Odpowiedzi</button>
        <div id="quiz-result" class="result-box" style="display:none"></div>
    </div>

    <button onclick="fetchData()">Pobierz Dane i Startuj Quiz</button>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        const map = L.map('map').setView([52.0, 19.0], 4);
        let currentMarker = null;

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // Zmienne globalne dla quizu
        let currentCountryData = null;
        let correctAnswerQ1 = "";
        let correctAnswerQ2 = "";
        let correctAnswerQ3 = "";

        async function fetchData() {
            const contentDiv = document.getElementById('content');
            const mapOverlay = document.getElementById('map-overlay');
            const triviaBox = document.getElementById('trivia-box');
            const triviaContent = document.getElementById('trivia-content');
            const quizBox = document.getElementById('quiz-box');
            const quizResult = document.getElementById('quiz-result');
            const btnQuiz = document.getElementById('btn-quiz-check');

            contentDiv.innerHTML = '<p class="loading">Pobieranie danych...</p>';
            mapOverlay.style.display = 'flex'; mapOverlay.innerText = 'Szukam kraju...';
            triviaBox.style.display = 'none';
            quizBox.style.display = 'none';
            quizResult.style.display = 'none';

            try {
                // 1. NBP
                const nbpResponse = await fetch('https://api.nbp.pl/api/exchangerates/tables/A/?format=json');
                if (!nbpResponse.ok) throw new Error('BÅ‚Ä…d NBP API');

                const nbpData = await nbpResponse.json();
                const rates = nbpData[0].rates;
                const randomCurrency = rates[Math.floor(Math.random() * rates.length)];

                // 2. RestCountries
                let countryInfoHtml = '';

                try {
                    const countryResponse = await fetch(`https://restcountries.com/v3.1/currency/${randomCurrency.code}`);
                    if (countryResponse.ok) {
                        const countries = await countryResponse.json();
                        currentCountryData = countries[0];

                        const countryNames = [...new Set(countries.map(c => c.translations.pol?.common || c.name.common))];
                        const flagUrl = currentCountryData.flags?.svg;

                        let namesString = countryNames.slice(0, 3).join(', ');
                        if (countryNames.length > 3) namesString += ` i ${countryNames.length - 3} inne`;

                        countryInfoHtml = `
                            <div class="country-section">
                                <div class="country-title">Kraj: ${countryNames[0]}</div>
                                <div class="country-info">
                                    ${flagUrl ? `<img src="${flagUrl}" class="flag-img" alt="Flaga">` : ''}
                                    <div class="country-names">${namesString}</div>
                                </div>
                            </div>
                        `;

                        // 3. Ciekawostka
                        const name = currentCountryData.translations.pol?.common || currentCountryData.name.common;
                        const capital = currentCountryData.capital ? currentCountryData.capital[0] : 'brak';
                        const population = currentCountryData.population.toLocaleString('pl-PL');
                        const region = currentCountryData.region;
                        const side = currentCountryData.car?.side === 'right' ? 'prawej' : 'lewej';
                        const unMember = currentCountryData.unMember ? 'Tak' : 'Nie';

                        const triviaText = `
                            <strong>${name}</strong> | Stolica: <strong>${capital}</strong> | LudnoÅ›Ä‡: <strong>${population}</strong>
                        `;
                        triviaContent.innerHTML = triviaText;
                        triviaBox.style.display = 'block';

                        // 4. Generuj Quiz
                        generateQuiz(name, region, side, unMember);
                        quizBox.style.display = 'block';
                        btnQuiz.style.display = 'inline-block';

                    } else {
                        countryInfoHtml = `<div class="country-section"><p>Brak danych o kraju.</p></div>`;
                    }
                } catch (e) {
                    console.warn(e);
                    countryInfoHtml = `<div class="country-section"><p>BÅ‚Ä…d API krajÃ³w</p></div>`;
                }

                // Mapa
                if (currentCountryData && currentCountryData.latlng) {
                    const lat = currentCountryData.latlng[0];
                    const lng = currentCountryData.latlng[1];
                    const zoomLevel = currentCountryData.area > 2000000 ? 4 : 5;
                    map.setView([lat, lng], zoomLevel);
                    if (currentMarker) map.removeLayer(currentMarker);
                    currentMarker = L.marker([lat, lng]).addTo(map)
                        .bindPopup(`<b>${currentCountryData.translations.pol?.common}</b>`)
                        .openPopup();
                    mapOverlay.style.display = 'none';
                } else {
                    mapOverlay.innerText = 'Nie znaleziono lokalizacji';
                }

                contentDiv.innerHTML = `
                    <div class="currency-code">${randomCurrency.code}</div>
                    <div class="currency-name">${randomCurrency.currency}</div>
                    <div class="currency-rate">${randomCurrency.mid} PLN</div>
                    ${countryInfoHtml}
                `;

            } catch (error) {
                console.error(error);
                contentDiv.innerHTML = `<p style="color:red">BÅ‚Ä…d: ${error.message}</p>`;
            }
        }

        function generateQuiz(countryName, region, side, unMember) {
            const container = document.getElementById('quiz-questions');
            document.getElementById('quiz-result').innerHTML = '';
            document.getElementById('quiz-result').style.display = 'none';

            const regions = ['Europe', 'Asia', 'Africa', 'Americas', 'Oceania', 'Antarctic'];
            correctAnswerQ1 = region;

            let optionsQ1 = regions.filter(r => r !== region).sort(() => 0.5 - Math.random()).slice(0, 2);
            optionsQ1.push(region);
            optionsQ1.sort(() => 0.5 - Math.random());

            correctAnswerQ2 = side;
            correctAnswerQ3 = unMember;

            container.innerHTML = `
                <div class="question-card">
                    <div class="question-text">1. W jakim regionie Å›wiata leÅ¼y ${countryName}?</div>
                    <div class="options" id="q1-options">
                        ${optionsQ1.map(opt => `<label><input type="radio" name="q1" value="${opt}"> ${opt}</label>`).join('')}
                    </div>
                </div>

                <div class="question-card">
                    <div class="question-text">2. Po ktÃ³rej stronie odbywa siÄ™ ruch drogowy?</div>
                    <div class="options" id="q2-options">
                        <label><input type="radio" name="q2" value="prawej"> Prawej</label>
                        <label><input type="radio" name="q2" value="lewej"> Lewej</label>
                    </div>
                </div>

                <div class="question-card">
                    <div class="question-text">3. Czy ten kraj naleÅ¼y do ONZ?</div>
                    <div class="options" id="q3-options">
                        <label><input type="radio" name="q3" value="Tak"> Tak</label>
                        <label><input type="radio" name="q3" value="Nie"> Nie</label>
                    </div>
                </div>
            `;
        }

        function checkQuiz() {
            // Reset stylÃ³w
            document.querySelectorAll('.options label').forEach(l => {
                l.classList.remove('option-correct', 'option-wrong');
            });

            const answers = { q1: correctAnswerQ1, q2: correctAnswerQ2, q3: correctAnswerQ3 };
            let score = 0;

            for (let i = 1; i <= 3; i++) {
                const qName = 'q' + i;
                const selected = document.querySelector(`input[name="${qName}"]:checked`);
                const correctVal = answers[qName];

                // ZnajdÅº poprawny element Å¼eby go zawsze podÅ›wietliÄ‡
                const allInputs = document.querySelectorAll(`input[name="${qName}"]`);
                let correctLabel = null;
                allInputs.forEach(input => {
                    if (input.value === correctVal) correctLabel = input.parentElement;
                });

                if (selected) {
                    if (selected.value === correctVal) {
                        score++;
                        selected.parentElement.classList.add('option-correct');
                    } else {
                        selected.parentElement.classList.add('option-wrong');
                        // Pokazujemy teÅ¼ poprawnÄ…, Å¼eby uÅ¼ytkownik wiedziaÅ‚
                        if (correctLabel) correctLabel.classList.add('option-correct');
                    }
                } else {
                    // Brak odpowiedzi - zaznacz poprawnÄ…
                    if (correctLabel) correctLabel.classList.add('option-correct');
                }
            }

            const resultBox = document.getElementById('quiz-result');
            resultBox.style.display = 'block';

            if (score === 3) {
                resultBox.className = 'result-box correct';
                resultBox.innerHTML = `Gratulacje! 3/3 poprawne odpowiedzi! ðŸŽ‰`;
            } else {
                resultBox.className = 'result-box wrong';
                resultBox.innerHTML = `TwÃ³j wynik: ${score}/3. Poprawne odpowiedzi zaznaczono na zielono.`;
            }
        }
    </script>
</body>

</html>
